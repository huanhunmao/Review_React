
# react-fiber  背后的原理是什么 流程是怎样的

React Fiber 是 React 中用于实现异步渲染的新的调度器。它的背后原理和流程如下：

1. **任务分割**：
   - React Fiber 将渲染工作分割成小的任务单元，称为 Fiber 节点。这些任务单元可以在渲染过程中被中断、暂停和恢复。

2. **优先级调度**：
   - 每个 Fiber 节点都有一个优先级，React 使用优先级调度器来决定哪些任务应该先执行，哪些任务可以等待。
   - 优先级高的任务会先执行，这使得 React 能够在渲染大型组件树时保持良好的响应性能。

3. **协调更新**：
   - 当组件状态发生变化时，React Fiber 会根据新的状态计算出新的虚拟 DOM 树。
   - 然后，React Fiber 会比较新旧虚拟 DOM 树之间的差异，并将变化应用到实际的 DOM 上。
   - 这个过程称为协调更新，通过将更新工作分割成小的任务单元，React 能够更好地控制更新的优先级和执行顺序。

4. **可中断性**：
   - 在进行渲染和更新过程中，React Fiber 具有可中断性，即可以在任何时候暂停正在进行的任务，并在需要时恢复执行。
   - 这使得 React 能够更好地响应用户输入和其他优先级更高的任务，提高了整体的用户体验。

总的来说，React Fiber 的背后原理是通过将渲染工作分割成小的任务单元，并使用优先级调度器来控制任务的执行顺序，从而实现更好的渲染性能和更好的用户体验。


# 更详细的 fiber 流程 
React Fiber 的实现涉及复杂的算法和数据结构。以下是 React Fiber 如何在代码中实现的简要概述：

1. **Fiber 节点**：
   - React Fiber 中的核心数据结构是 Fiber 节点，它表示了组件树中的每个组件及其状态。Fiber 节点包含了组件的类型、属性、状态、子节点等信息，以及与调度相关的优先级、更新状态等信息。

2. **协调更新**：
   - React Fiber 使用协调算法来处理组件的更新。当组件状态发生变化时，React 会创建新的 Fiber 树，并通过比较新旧 Fiber 树的差异来确定需要更新的部分。这个过程称为协调更新。

3. **调度器**：
   - React Fiber 引入了一个优先级调度器，用于确定哪些任务应该先执行。调度器根据任务的优先级和当前页面的渲染情况来决定任务的执行顺序，以确保页面的响应性和流畅性。

4. **异步渲染**：
   - React Fiber 支持异步渲染，即在渲染过程中可以中断和恢复任务的执行。这使得 React 能够更好地处理用户交互和其他异步操作，提高了整体的渲染性能。

5. **任务调度**：
   - React Fiber 使用循环遍历的方式执行任务调度，即在每一帧中执行一定数量的任务，然后根据优先级决定是否继续执行下一帧中的任务，直到完成所有任务。

6. **渲染阶段和提交阶段**：
   - React Fiber 的渲染过程分为两个阶段：渲染阶段和提交阶段。在渲染阶段，React Fiber 根据组件的更新情况构建 Fiber 树；在提交阶段，React Fiber 将 Fiber 树中的变化同步到实际的 DOM 中。

综上所述，React Fiber 的实现包括了对组件更新的协调算法、优先级调度器的设计和任务执行的管理等方面，通过这些机制实现了更好的性能和用户体验。